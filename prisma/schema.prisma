generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TenantCredential {
  id              String   @id @default(cuid())
  tenantId        String
  provider        String
  model           String
  apiKeyEncrypted String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([tenantId, provider])
}

model PromptVersion {
  id        String   @id @default(cuid())
  tenantId  String   @default("global")
  version   Int
  data      Json
  createdAt DateTime @default(now())

  @@unique([tenantId, version])
}

model GenerateLog {
  id            String   @id @default(cuid())
  organizationId String?
  contentType   String
  provider       String
  model          String
  duration       Int      // milliseconds
  tokensUsed     Int?
  tokensInput    Int?
  tokensOutput   Int?
  success        Boolean
  errorMessage   String?
  metadata       Json?    // Additional metadata (topic, focusKeyword, etc.)
  createdAt      DateTime @default(now())

  @@index([organizationId, createdAt])
  @@index([contentType, createdAt])
}

model LibraryContent {
  id            String   @id @default(cuid())
  organizationId String?
  contentType   String
  title         String
  currentVersion Int     @default(1)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  versions      LibraryVersion[]

  @@index([organizationId, createdAt])
  @@index([contentType, createdAt])
}

model LibraryVersion {
  id            String   @id @default(cuid())
  libraryContentId String
  version       Int
  data          Json
  preview       String?
  metadata      Json?    // model, provider, promptVersion, etc.
  createdAt     DateTime @default(now())

  libraryContent LibraryContent @relation(fields: [libraryContentId], references: [id], onDelete: Cascade)

  @@unique([libraryContentId, version])
  @@index([libraryContentId, version])
}

